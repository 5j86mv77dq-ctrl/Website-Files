---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Blog">
  <div class="container">
    <img src="/images/road.jpg" alt="Blog" class="featured-image" />
    <h1>Blog</h1>
    <p style="font-size: 1.25rem; color: #4b5563; margin-bottom: 3rem;">
      Essays on marketing strategy, audience development, and professional insights from Catholic media.
    </p>
    
    {sortedPosts.length === 0 ? (
      <p>No posts yet. Check back soon!</p>
    ) : (
      <ul class="post-list">
        {sortedPosts.map((post) => (
          <li class="post-item">
            <div class="post-date">
              {new Date(post.data.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </div>
            <h2 class="post-title">
              <a href={`/blog/${post.slug}`}>{post.data.title}</a>
            </h2>
            {post.data.description && (
              <p class="post-excerpt">{post.data.description}</p>
            )}
            <a href={`/blog/${post.slug}`}>Read more â†’</a>
          </li>
        ))}
      </ul>
    )}

    <section class="email-signup">
      <h3>Subscribe</h3>
      <p>Get new posts delivered to your inbox:</p>
      <script async data-uid="69221d673c" src="https://peteratkinson.kit.com/69221d673c/index.js"></script>
    </section>
  </div>
</BaseLayout>
